platform :macos do
  lane :build do
    build_mac_app(
      workspace: "ClickUpWidget.xcworkspace",
      scheme: "ClickUpWidget",
      export_method: "developer-id",
      output_directory: "build"
    )
  end

  lane :deploy_dmg do
    setup_ci if ENV['CI']
    match(type: "developer_id", platform: "macos")
    build
    notarize(
      package: "build/ClickUpWidget.app",
      bundle_id: "com.yannickpulver.clickupwidget",
      api_key_path: "fastlane/mac-api-key.json",
      print_log: true
    )
    sh("brew install create-dmg || true")
    sh('create-dmg --volname "ClickUp Widget" --no-internet-enable "../build/ClickUpWidget.dmg" "../build/ClickUpWidget.app"')
  end
end
